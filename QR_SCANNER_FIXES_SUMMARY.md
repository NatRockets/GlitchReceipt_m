# QR Scanner - –ü–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "Start Scanning" –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è –∑–≤—É–∫, –Ω–æ –∫–∞–º–µ—Ä–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ —ç–∫—Ä–∞–Ω –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**
–î–æ–±–∞–≤–ª–µ–Ω—ã print-–ª–æ–≥–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–æ—á–∫–∞—Ö:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤ `initState()`
- –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ `_requestCameraPermission()`
- –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã –≤ `_startScanning()`
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ QR –∫–æ–¥–æ–≤ –≤ `_handleBarcode()`
- –°–æ—Å—Ç–æ—è–Ω–∏–µ UI –≤ `build()`

**–ü–æ–ª—å–∑–∞:** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤ logcat/console –≥–¥–µ –∏–º–µ–Ω–Ω–æ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.

### 2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è**
```dart
bool _isProcessingQR = false;  // –§–ª–∞–≥ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

void _handleBarcode(BarcodeCapture capture) {
  if (_isProcessingQR) return;  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –µ—Å–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
  _isProcessingQR = true;       // –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
  // ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–¥–∏–Ω QR –∫–æ–¥ –Ω–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥.

### 3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π**

–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:

```dart
// –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫–æ–¥–∞:
await controller.stop();  // –°–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
_showNoteDialog(value);   // –ü–æ—Ç–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥

// –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –¥–∏–∞–ª–æ–≥–∞:
await _resumeScanning();  // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É

// –° –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫:
try {
  await controller.start();
} catch (e) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏, –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–∞–º–µ—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

### 4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π**

```dart
Future<bool> _requestCameraPermission() async {
  var status = await Permission.camera.status;
  
  if (status.isDenied) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω—ã–π iOS –¥–∏–∞–ª–æ–≥ —Å —Ç–µ–∫—Å—Ç–æ–º –∏–∑ Info.plist
    status = await Permission.camera.request();
  }
  
  return status.isGranted;
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥ iOS
- –¢–µ–∫—Å—Ç –±–µ—Ä–µ—Ç—Å—è –∏–∑ `Info.plist` (`NSCameraUsageDescription`)
- –ï—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –±—ã–ª–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å Settings

### 5. **–î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö**

–í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ "Camera is not available" —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:
```
Failed to start camera: [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –æ—à–∏–±–∫–∞]
Camera error: CAMERA_ERROR_UNKNOWN
[–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ–µ–≥—á–µ –ø–æ–Ω—è—Ç—å —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.

### 6. **–£–ª—É—á—à–µ–Ω–Ω—ã–π UI –ø—Ä–∏ –æ—à–∏–±–∫–µ –∫–∞–º–µ—Ä—ã**

–í MobileScanner –¥–æ–±–∞–≤–ª–µ–Ω `errorBuilder`:
```dart
MobileScanner(
  controller: controller,
  errorBuilder: (context, error, child) {
    return Center(
      child: Column(
        children: [
          Text('Camera error: ${error.errorCode}'),
          Text(error.errorDetails?.message ?? 'Unknown'),
        ],
      ),
    );
  },
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —á–µ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —á–µ—Ä–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞.

### 7. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**

–í `initState()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
```dart
@override
void initState() {
  super.initState();
  try {
    controller = MobileScannerController();
    print('[QR Scanner] MobileScannerController initialized');
  } catch (e) {
    print('[QR Scanner] Error initializing controller: $e');
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è, –º—ã –æ–± —ç—Ç–æ–º —É–∑–Ω–∞–µ–º –∏–∑ –ª–æ–≥–æ–≤.

## üîç –ö–∞–∫ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
```
Settings ‚Üí Glitch Receipt ‚Üí Camera
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Allow"
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –ª–æ–≥–∞–º–∏
```bash
flutter run -v
```

### –®–∞–≥ 3: –ù–∞–∂–∞—Ç—å "Start Scanning" –∏ –∏—Å–∫–∞—Ç—å –≤ logcat:
```
[QR Scanner] _startScanning called
[QR Scanner] Checking camera permission...
[QR Scanner] Starting camera controller...
```

### –®–∞–≥ 4: –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**
```
[QR Scanner] Permission request result: PermissionStatus.denied
```
‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤ –¥–∏–∞–ª–æ–≥–µ iOS

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**
```
[QR Scanner] Permission permanently denied
```
‚Üí –ù—É–∂–Ω–æ –∏–¥—Ç–∏ –≤ Settings –∏ –≤–∫–ª—é—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:**
```
[QR Scanner] Camera controller started
[QR Scanner] Setting _isScanning = true
```
‚Üí –í—Å–µ —Ö–æ—Ä–æ—à–æ, –∫–∞–º–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É —Ç–∏–ø–∞:**
```
[QR Scanner] Error in _startScanning: Camera initialization failed
```
‚Üí –ü—Ä–æ–±–ª–µ–º–∞ —Å –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π —á–∞—Å—Ç—å—é –∏–ª–∏ Xcode –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## üìã –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
1. –ù–∞–∂–∞—Ç—å "Start Scanning"
   ‚Üì
2. –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç—Å—è –∑–≤—É–∫ (feedback.selectionClick)
   ‚Üì
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
   ‚îú‚îÄ –ï—Å–ª–∏ –Ω–µ –¥–∞–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è iOS –¥–∏–∞–ª–æ–≥
   ‚îú‚îÄ –ï—Å–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ Settings
   ‚îî‚îÄ –ï—Å–ª–∏ –¥–∞–Ω–æ: –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 4
   ‚Üì
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è MobileScannerController
   ‚Üì
5. –ó–∞–¥–µ—Ä–∂–∫–∞ 300–º—Å (–∂–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
   ‚Üì
6. setState(_isScanning = true)
   ‚Üì
7. UI –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è: –≤–∏–¥–Ω–∞ –∫–∞–º–µ—Ä–∞ + –∫–Ω–æ–ø–∫–∞ "Stop Scanning"
   ‚Üì
8. –°–∫–∞–Ω–µ—Ä –∂–¥–µ—Ç QR –∫–æ–¥–æ–≤
   ‚Üì
9. QR –∫–æ–¥ –Ω–∞–π–¥–µ–Ω:
   ‚îú‚îÄ –í–∞–ª–∏–¥–Ω–∞—è —Å—É–º–º–∞ ‚Üí –¥–∏–∞–ª–æ–≥ –∑–∞–º–µ—Ç–∫–∏ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
   ‚îî‚îÄ –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è ‚Üí –¥–∏–∞–ª–æ–≥ –æ—à–∏–±–∫–∏ ‚Üí –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–±–æ—Ä–∫–∞
```bash
flutter clean
flutter pub get
flutter run -v
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –¥–µ–≤–∞–π—Å–µ
```bash
# –í Xcode:
# Product ‚Üí Clean Build Folder
# –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –¥–µ–≤–∞–π—Å–∞
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å: flutter run
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Info.plist
–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ `/ios/Runner/Info.plist` –µ—Å—Ç—å:
```xml
<key>NSCameraUsageDescription</key>
<string>This app needs access to your camera to scan QR codes</string>
<key>NSMicrophoneUsageDescription</key>
<string>Microphone permission is required for camera access...</string>
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- iOS –≤–µ—Ä—Å–∏—è: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 13.0+
- –î–µ–≤–∞–π—Å: —Ä–µ–∞–ª—å–Ω—ã–π iPhone (—Å–∏–º—É–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞–º–µ—Ä–æ–π)
- Flutter –≤–µ—Ä—Å–∏—è: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å mobile_scanner 5.2.3

## üìä –°–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| State | UI | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----|----|
| `_isScanning = false` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ "Start Scanning" –∏ "Enter Manually" |
| `_isScanning = true` | –ü—Ä–µ–≤—å—é –∫–∞–º–µ—Ä—ã | –í–∏–¥–Ω–∞ –∫–∞–º–µ—Ä–∞, —Å–∫–∞–Ω–∏—Ä—É—é—Ç—Å—è QR –∫–æ–¥—ã |
| `_isProcessingQR = true` | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ | –ò–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–æ–≤—ã–µ QR –∫–æ–¥—ã, –∏–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| –î–∏–∞–ª–æ–≥ –ø–æ–∫–∞–∑–∞–Ω | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ | –ö–Ω–æ–ø–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã, –≤–∏–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–∏–∞–ª–æ–≥–∞ |

## üìù –ü–æ–ª—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ logs –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç:
```
[QR Scanner] _startScanning called, mounted: true
[QR Scanner] Checking camera permission...
[QR Scanner] Camera permission status: [—Å—Ç–∞—Ç—É—Å]
[QR Scanner] Starting camera controller...
[QR Scanner] Camera controller started
[QR Scanner] Setting _isScanning = true
[QR Scanner] build() called, _isScanning: true
```

–í—Å–µ —ç—Ç–∏ –ª–æ–≥–∏ –ø–æ–º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É.
